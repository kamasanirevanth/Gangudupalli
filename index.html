<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fund Utilization</title>
    <style>
      /* General Styles */
      body {
        font-family: "Poppins", sans-serif;
        margin: 0;
        padding: 0;
        min-height: 100vh;
        background: linear-gradient(135deg, #74ebd5 0%, #acb6e5 100%);
        color: #333;
      }

      a {
        text-decoration: none;
        color: inherit;
      }

      /* Navbar Styling */
      .navbar {
        background: rgba(0, 123, 255, 0.25);
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.18);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.18);
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 2rem;
        position: sticky;
        top: 0;
        z-index: 1000;
      }

      .navbar a {
        color: white;
        font-weight: bold;
        padding: 0.8rem 1.2rem;
        border-radius: 10px;
        position: relative;
        overflow: hidden;
        transition: background 0.3s, color 0.3s, box-shadow 0.3s;
      }

      /* Glass effect on hover */
      .navbar a:hover {
        background: rgba(255, 255, 255, 0.18);
        box-shadow: 0 4px 16px rgba(31, 38, 135, 0.18);
        color: #007bff;
      }

      /* Liquid glass animated effect on text */
      .navbar a::after {
        content: "";
        position: absolute;
        left: -75%;
        top: 0;
        width: 250%;
        height: 100%;
        background: linear-gradient(
          120deg,
          rgba(255, 255, 255, 0.3) 0%,
          rgba(0, 123, 255, 0.1) 50%,
          rgba(255, 255, 255, 0.3) 100%
        );
        opacity: 0;
        transition: opacity 0.3s, left 0.5s;
        z-index: 0;
      }
      .navbar a:hover::after {
        opacity: 1;
        left: 0;
        animation: liquid-move 0.7s linear;
      }
      @keyframes liquid-move {
        0% {
          left: -75%;
        }
        100% {
          left: 0;
        }
      }
      .navbar a {
        position: relative;
        z-index: 1;
      }
      .navbar a span {
        position: relative;
        z-index: 2;
      }

      /* Responsive Grid Container */
      .container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        padding: 2rem;
      }

      /* Card Styling */
      .card {
        background: rgba(255, 255, 255, 0.18);
        border-radius: 20px;
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.18);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.25);
        padding: 2rem 1.5rem;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .card:hover {
        transform: translateY(-5px) scale(1.03);
        box-shadow: 0 12px 24px rgba(31, 38, 135, 0.25);
      }

      .card h2 {
        margin-top: 0;
        font-size: 1.4rem;
        color: #007bff;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      }

      /* Table Styles */
      table {
        width: 100%;
        border-collapse: collapse;
      }

      th,
      td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }

      th {
        background-color: #f1f1f1;
        font-weight: bold;
      }

      tr:hover {
        background-color: #f9f9f9;
      }

      /* Modal Styling */
      .modal {
        display: none;
        position: fixed;
        z-index: 9999;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6);
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background-color: white;
        border-radius: 10px;
        padding: 2rem;
        width: 90%;
        max-width: 400px;
        text-align: center;
      }

      .modal-content button {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      .modal-content button:hover {
        background-color: #0056b3;
      }

      /* Responsive Styling */
      @media (max-width: 768px) {
        .navbar {
          flex-direction: column;
          padding: 1rem;
          width: 100vw;
          min-width: 100vw;
          max-width: 100vw;
        }
        .navbar a {
          padding: 0.8rem;
          margin: 0.5rem 0;
          width: 90vw;
          box-sizing: border-box;
        }
        .glass-btn {
          width: 90vw;
        }
      }
      /* Popup Modal for Voucher Table */
      .voucher-modal {
        display: none;
        position: fixed;
        z-index: 99999;
        left: 0;
        top: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0,0,0,0.5);
        justify-content: center;
        align-items: center;
      }
      .voucher-modal-content {
        background: rgba(255,255,255,0.95);
        border-radius: 18px;
        box-shadow: 0 8px 32px rgba(31,38,135,0.18);
        padding: 2em 1em 1em 1em;
        max-width: 95vw;
        width: 600px;
        position: relative;
        margin: 2em auto;
        overflow-x: auto;
        max-height: 80vh;
        overflow-y: auto;
        scroll-behavior: smooth;
      }
      @media (max-width: 600px) {
        .voucher-modal-content {
          width: 98vw;
          max-width: 98vw;
          padding: 1em 0.2em 0.5em 0.2em;
        }
        .voucher-table th, .voucher-table td {
          font-size: 0.95em;
          padding: 8px 4px;
        }
        .card h2 {
          font-size: 1.1rem;
        }
      }
      .voucher-modal-close {
        position: absolute;
        top: 10px;
        right: 18px;
        font-size: 2em;
        color: #007bff;
        background: none;
        border: none;
        cursor: pointer;
        z-index: 100;
        transition: color 0.2s;
      }
      .voucher-modal-close:hover {
        color: #ff9800;
      }
      /* Footer Specific Styles */
        .footer {
            background: rgba(0, 123, 255, 0.25);
            box-shadow: 0 -8px 32px 0 rgba(31, 38, 135, 0.18);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255, 255, 255, 0.18);
            padding: 1rem;
            text-align: center;
            color: #fff;
        }
    </style>
  </head>
  <body class="check_gok_chrome_installed">
    <div class="navbar">
      <a href="https://gangudupalli.in/home/index.html#home" aria-label="Home"
        >Home</a
      >
      <a
        href="https://gangudupalli.in/home/index.html#services"
        aria-label="Services"
        >Services</a
      >
      <a
        href="https://gangudupalli.in/home/index.html#about"
        aria-label="About Us"
        >About Us</a
      >
      <a
        href="https://gangudupalli.in/home/index.html#contact"
        aria-label="Contact"
        >Contact</a
      >
      <a href="https://gangudupalli.in/gpoffice/people-rep.html"
        >Representatives</a
      >
      <a href="https://gangudupalli.in/gpoffice/index.html">GP Office Staff</a>
      <button class="glass-btn" onclick="openYearMenu()" aria-label="Funds Utilization">
        Funds Utilization
      </button>

      <div id="yearMenuModal" class="modal year-modal-flex">
        <div class="modal-content glass-modal">
          <h2>Select Financial Year</h2>
          <div class="year-list">
            <br /><br /><br /><br /><br />
            <button onclick="showProgress('FY 2024-2025')">
              FY 2024-2025
            </button>
            <button onclick="showProgress('FY 2023-2024')">
              FY 2023-2024
            </button>
            <button onclick="showProgress('FY 2022-2023')">
              FY 2022-2023
            </button>
            <button onclick="showProgress('FY 2021-2022')">
              FY 2021-2022
            </button>
            <button onclick="showProgress('FY 2020-2021')">
              FY 2020-2021
            </button>
          </div>
          <div
            id="progressMsg"
            style="display: none; margin-top: 1rem; color: #007bff; font-weight: bold"
          ></div>
          <button style="margin-top: 1.5rem" onclick="closeYearMenu()">
            Close
          </button>
        </div>
      </div>

      <script>
        function openYearMenu() {
          document.getElementById("yearMenuModal").style.display = "flex";
          document.getElementById("progressMsg").style.display = "none";
        }
        function closeYearMenu() {
          document.getElementById("yearMenuModal").style.display = "none";
        }
        function showProgress(year) {
          var msg = "Updates are under progress...";
          if (year) msg += " <br><span style='font-size:1.1em;'>" + year + "</span>";
          var el = document.getElementById("progressMsg");
          el.innerHTML = msg;
          el.style.display = "block";
        }
      </script>
    </div>


    <marquee
      behavior="scroll"
      direction="left"
      scrollamount="5"
      style="color: red; font-weight: bold"
    >
      Updates are under progress...Currently FY 2025-2026,2024-25 & 2023-24 are available and remaining are being prepared.
    </marquee>
    <div class="disclaimer" style="margin:2em auto 1em auto;max-width:700px;text-align:left;color:#d32f2f;font-weight:500;background:rgba(255,255,255,0.22);padding:1.2em 2em 1em 2em;border-radius:14px;box-shadow:0 4px 16px rgba(31,38,135,0.10);">
      <div style="display:flex;align-items:center;gap:0.7em;margin-bottom:0.5em;">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" style="flex-shrink:0;"><circle cx="12" cy="12" r="12" fill="#d32f2f" opacity="0.12"/><path d="M12 8v4m0 4h.01" stroke="#d32f2f" stroke-width="2" stroke-linecap="round"/></svg>
        <span style="font-size:1.15em;font-weight:600;">Disclaimer</span>
      </div>
      <div style="font-size:1em;line-height:1.7;color:#333;">
        This dashboard is created independently to raise awareness among citizens about fund utilization in Gangudupalli Panchayat. The details shown are for informational purposes only and may differ from official records.<br>
        <span style="color:#d32f2f;font-weight:600;">For authentic and up-to-date information, please contact the respective government department.</span>
      </div>
      <div style="font-size:0.97em;color:#555;margin-top:0.7em;">
        The creators do not guarantee the accuracy, completeness, or timeliness of the data. This is not an official government publication. No legal liability is accepted for any errors or omissions. If you require official data for legal or administrative purposes, always verify with the Panchayat office or relevant authorities.
      </div>
    </div>

    <div id="popupModal" class="modal">
      <div class="modal-content">
        <h2>Coming Soon</h2>
        <p>
          Fund Utilization for the selected financial year will be available
          shortly.
        </p>
        <button onclick="closePopup()">Close</button>
      </div>
    </div>

    <script>
      function showPopup() {
        document.getElementById("popupModal").style.display = "flex";
      }

      function closePopup() {
        document.getElementById("popupModal").style.display = "none";
      }

      window.onclick = function (event) {
        var modal = document.getElementById("popupModal");
        if (event.target === modal) {
          closePopup();
        }
      };
    </script>

    <div style="text-align:right; margin: 1em 2em 0 0;">
      <button id="clearCacheBtn" style="background:#ff9800;color:#fff;border:none;padding:0.7em 1.5em;border-radius:7px;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.08);font-weight:bold;">Clear Cache</button>
    </div>
    <div class="container">
      <div class="container" id="dashboardContainer"></div>
      <!-- Voucher Table Popup Modal -->
      <div id="voucherModal" class="voucher-modal">
        <div class="voucher-modal-content" id="voucherModalContent">
          <button class="voucher-modal-close" id="voucherModalClose" aria-label="Close">&times;</button>
          <div id="voucherModalBody"></div>
          <div style="margin:2em 0 0 0;padding:0.7em 1em 0.2em 1em;text-align:center;background:rgba(255,255,255,0.13);border-radius:8px;font-size:0.98em;color:#d32f2f;">
            <strong>Note:</strong> This data is for awareness only and may differ from official records. For authentic information, contact the Panchayat office.
          </div>
          <button class="voucher-modal-close" id="voucherModalCloseBottom" aria-label="Close" style="position:static;display:block;margin:1.5em auto 0 auto;font-size:2em;">&times;</button>
        </div>
      </div>

      <style>
        /* Under Progress Spinner Icon */
        .progress-icon {
          display: inline-block;
          width: 1em;
          height: 1em;
          margin-left: 0.5em;
          border: 2px solid #007bff;
          border-top: 2px solid #fff;
          border-radius: 50%;
          animation: spin 0.8s linear infinite;
          vertical-align: middle;
        }
        @keyframes spin {
          0% {
            transform: rotate(0deg);
          }
          100% {
            transform: rotate(360deg);
          }
        }
        .voucher-table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 1em;
          background: rgba(255,255,255,0.18);
          border-radius: 16px;
          box-shadow: 0 8px 32px 0 rgba(31,38,135,0.18);
          backdrop-filter: blur(8px);
          -webkit-backdrop-filter: blur(8px);
          overflow: hidden;
        }
        .voucher-table th,
        .voucher-table td {
          font-size: 1em;
          padding: 12px 10px;
          border-bottom: 1px solid rgba(0,123,255,0.10);
          position: relative;
        }
        .voucher-table th {
          background: linear-gradient(120deg, rgba(0,123,255,0.18) 0%, rgba(255,255,255,0.25) 100%);
          color: #007bff;
          font-weight: bold;
          text-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        /* Alternate row colors */
        .voucher-table tr:nth-child(even) td {
          background: #e3f2fd;
        }
        .voucher-table tr:nth-child(odd) td {
          background: #fff;
        }
        .voucher-table tr {
          transition: background 0.3s;
        }
        .voucher-table tr:hover td {
          background: linear-gradient(90deg, rgba(0,123,255,0.12) 0%, rgba(255,255,255,0.32) 100%);
        }
        .total-row td {
          font-weight: bold;
          background: linear-gradient(90deg, #e3f2fd 0%, #fff 100%);
          color: #007bff;
          border-bottom: none;
        }
      </style>

      <script>
        // Years to show
        const years = [
          "2025-2026",
          "2024-2025",
          "2023-2024",
          "2022-2023",
          "2021-2022",
          "2020-2021",
        ];
        const mainYear = years[0];

        // Local JSON file base
        function getJsonFile(year) {
          // e.g., funds_2024_2025.json
          return `funds_${year.replace("-", "_")}.json`;
        }

        // Simple cache
        const voucherCache = {};

        // Render all FY dashboards
        function renderAllDashboards() {
          const container = document.getElementById("dashboardContainer");
          container.innerHTML = "";
          years.forEach((year, idx) => {
            const card = document.createElement("div");
            card.className = "card";
            card.id = `card-${year}`;
            // Add breakdown button for every year, but hide if no data
            let btn = `<button class="showBreakdownBtn" data-year="${year}" style="margin-top:1em;background:#007bff;color:#fff;border:none;padding:0.7em 1.5em;border-radius:7px;cursor:pointer;">Show Breakdown</button>`;
            card.innerHTML = `<h2>Fund Utilization ${year}</h2><div class="card-content" id="card-content-${year}"><span class='progress-icon'></span> Loading...</div>${btn}`;
            container.appendChild(card);
          });
        }

        // Fetch and display vouchers for a year
        function fetchAndDisplayVouchers(year, showTable = true) {
          const cardContent = document.getElementById(`card-content-${year}`);
          const breakdownBtn = document.querySelector(`#card-${year} .showBreakdownBtn`);
          function updateBreakdownBtn(data) {
            // Hide breakdown button if no data or total is 0
            if (!Array.isArray(data) || data.length === 0 || data.reduce((sum, v) => sum + parseFloat(v.amount || 0), 0) === 0) {
              if (breakdownBtn) breakdownBtn.style.display = 'none';
            } else {
              if (breakdownBtn) breakdownBtn.style.display = '';
            }
          }
          if (voucherCache[year]) {
            updateBreakdownBtn(voucherCache[year]);
            if (showTable) displayVoucherTable(year, voucherCache[year], cardContent);
            else displayTotalOnly(year, voucherCache[year]);
            return;
          }
          fetch(getJsonFile(year))
            .then((res) => res.json())
            .then((data) => {
              voucherCache[year] = data;
              updateBreakdownBtn(data);
              if (showTable) displayVoucherTable(year, data, cardContent);
              else displayTotalOnly(year, data);
            })
            .catch(() => {
              cardContent.innerHTML =
                "<span style='color:red'>Unable to load data / Data not available.</span>";
              if (breakdownBtn) breakdownBtn.style.display = 'none';
            });
        }

        // Show only total spent for main FY
        function displayTotalOnly(year, data) {
          const el = document.getElementById(`card-content-${year}`);
          if (!Array.isArray(data) || data.length === 0) {
            el.innerHTML = "<span style='color:orange'>No data available.</span>";
            return;
          }
          let total = data.reduce((sum, v) => sum + parseFloat(v.amount), 0);
          el.innerHTML = `<div style='font-size:2em;font-weight:bold;color:#007bff;'>₹${total.toLocaleString(
            "en-IN",
            { minimumFractionDigits: 2 }
          )}</div>
          <div style='margin-top:0.5em;color:#555;'>Total Amount Spent (FY ${year})</div>`;
        }

        // Display voucher table and total in popup
        function displayVoucherTable(year, data, cardContent) {
          if (!Array.isArray(data) || data.length === 0) {
            document.getElementById('voucherModalBody').innerHTML = "<span style='color:orange'>No data available.</span>";
            showVoucherModal();
            return;
          }
          let total = 0;
          let rows = data
            .map((v, i) => {
              total += parseFloat(v.amount);
              return `<tr${
                i % 2 === 0 ? " style='background:#e3f2fd;'" : ""
              }><td>${v.voucherno}</td><td>${v.voucherdate}</td><td>${v.vendor}</td><td>${
                v.amount
              }</td><td>${v.status}</td></tr>`;
            })
            .join("");
          let table = `<table class='voucher-table'><thead><tr><th>Voucher No</th><th>Date</th><th>Vendor</th><th>Amount</th><th>Status</th></tr></thead><tbody>${rows}</tbody><tfoot><tr class='total-row'><td colspan='3'>Total</td><td colspan='2'>₹${total.toLocaleString(
            "en-IN",
            { minimumFractionDigits: 2 }
          )}</td></tr></tfoot></table>`;
          document.getElementById('voucherModalBody').innerHTML = `<h2 style='margin-bottom:1em;color:#007bff;'>Fund Utilization ${year}</h2>` + table;
          showVoucherModal();
        }

        // Show voucher modal
        function showVoucherModal() {
          document.getElementById('voucherModal').style.display = 'flex';
          document.body.style.overflow = 'hidden';
        }
        // Hide voucher modal
        function hideVoucherModal() {
          document.getElementById('voucherModal').style.display = 'none';
          document.body.style.overflow = '';
        }

        // Clear cache and reload dashboards
        function clearVoucherCache() {
          for (const year of years) {
            delete voucherCache[year];
          }
          renderAllDashboards();
          years.forEach((year) => {
            fetchAndDisplayVouchers(year, false);
          });
          attachBreakdownEvents();
        }

        // Attach breakdown button events for all FYs
        function attachBreakdownEvents() {
          const btns = document.querySelectorAll('.showBreakdownBtn');
          btns.forEach((btn) => {
            const year = btn.getAttribute('data-year');
            btn.onclick = function () {
              // Hide other cards
              years.forEach((y) => {
                const card = document.getElementById(`card-${y}`);
                if (y !== year) card.style.display = 'none';
                else card.style.display = '';
              });
              fetchAndDisplayVouchers(year, true);
              btn.style.display = 'none'; // Hide breakdown button when modal is open
            };
          });
          // Attach close event for voucher modal
          function closeVoucherModalAndRestore() {
            // Show all cards
            years.forEach((y) => {
              const card = document.getElementById(`card-${y}`);
              card.style.display = '';
            });
            // Show all breakdown buttons
            btns.forEach((btn) => {
              btn.style.display = '';
            });
            hideVoucherModal();
          }
          document.getElementById('voucherModalClose').onclick = closeVoucherModalAndRestore;
          document.getElementById('voucherModalCloseBottom').onclick = closeVoucherModalAndRestore;
        }

        // On page load
        document.addEventListener("DOMContentLoaded", function () {
          renderAllDashboards();
          years.forEach((year) => {
            fetchAndDisplayVouchers(year, false);
          });
          attachBreakdownEvents();
          // Attach clear cache button event
          document.getElementById("clearCacheBtn").onclick = clearVoucherCache;
        });
      </script>

      <div id="popupModal" class="modal">
        <div class="modal-content">
          <h2>Coming Soon</h2>
          <p>
            Fund Utilization for the selected financial year will be available
            shortly.
          </p>
          <button onclick="closePopup()">Close</button>
        </div>
      </div>

      <script>
        function showPopup() {
          document.getElementById("popupModal").style.display = "flex";
        }

        function closePopup() {
          document.getElementById("popupModal").style.display = "none";
        }

        window.onclick = function (event) {
          var modal = document.getElementById("popupModal");
          if (event.target === modal) {
            closePopup();
          }
        };
      </script>
      <br />
  </body>
</html>